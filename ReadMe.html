<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Freenet and mercurial</title>
</head>
<body style="margin: 1cm">
<p>&nbsp;</p>
<h1>Freenet &amp; mercurial</h1>
<p><a href="/?newbookmark=USK@MYLAnId-ZEyXhDGGbYOa1gOtkZZrFNTXjFl1dibLj9E,Xpu27DoAKKc8b0718E-ZteFrGqCYROe7XBBJI57pB4M,AQACAAE/pyFreenetHg/1/&amp;desc=Freenet and Mercurial" target="_blank">add to bookmarks: Freenet and Mercurial</a></p>
<p><a href="/?newbookmark=USK@fQGiK~CfI8zO4cuNyhPRLqYZ5TyGUme8lMiRnS9TCaU,E3S1MLoeeeEM45fDLdVV~n8PCr9pt6GMq0tuH4dRP7c,AQACAAE/freenethg/1/&amp;desc=Freenet and Mercurial (repository)" target="_blank">add to bookmarks: Freenet and Mercurial (repository)</a></p>
<p>&nbsp;</p>
<h3>licence</h3>
<p>this document and pyFreenetHg is published under the strong WTFPL</p>
<a href="COPYING" target="_blank">licence</a>
<h3>pyFreenetHg</h3>
<p>
Mercurial is written in phyton and have a plugin system. so it should not be to much difficulty to get it
working with freenet.<br>
<pre>
the basic idea: wrap around (selected) commands and use freenet as transport instead files
     hg fcp-bundle   -> wraps around hg bundle and put a chk/usk instead a local file
     hg fcp-unbundle -> wraps around hg unbundle and get it from a chk/usk instead a local file	
     hg fcp-updatestatic -> do a commit hook upload, useful if the insert started from commit hook was failed
     
hooks:
     updatestatic_hook -> does a full upload on each commit
     updatestatic_hook2 -> upload is only triggered on keyword in commit message
     updatestatic_hook3 (in progress) -> upload is only triggered on keyword in commit message
                                      -> SiteToolPlugin is used to reduce upload size on large trees (if plugin is installed)     

</pre>
<h3>requirements</h3>
<p>
python &gt;= 2.4<br>
mercurial &gt;= 1.x<br>
last not least: a running freenet node ;)<br />
optional: <a href="/USK@MYLAnId-ZEyXhDGGbYOa1gOtkZZrFNTXjFl1dibLj9E,Xpu27DoAKKc8b0718E-ZteFrGqCYROe7XBBJI57pB4M,AQACAAE/SiteToolPlugin/0/" target="_blank">SiteToolPlugin</a>
</p>
<h3>getting</h3>
<p><a href="FreenetHg.py" target="_blank">download from here</a></p>
<p>hg&nbsp;clone|pull&nbsp;static-http://127.0.0.1:8888/USK@fQGiK~CfI8zO4cuNyhPRLqYZ5TyGUme8lMiRnS9TCaU,E3S1MLoeeeEM45fDLdVV~n8PCr9pt6GMq0tuH4dRP7c,AQACAAE/freenethg/1/&nbsp;/tmp/your/local/path</p>
<h3>install pyFreenetHg</h3>
<p><b><i>Important hint:</i></b> Do not store url encoded keys into hgrc (USK%40MY). Python does not like '%' here!</p> 
<p>download <a href="FreenetHg.py" target="_blank">FreenetHg.py</a> and put it somewhere.<br>
add the following to your <i>~/.hgrc</i>:
</p>
<pre>
[extensions]
freenethg=/path/to/FreenetHg.py
</pre>
<h3>per repository configuration</h3>
<p>To prevent identity leaks you should add an username to each <i>./hg/hgrc</i>:
<pre>
[ui]
username = &lt;thenametouse&gt;
</pre>
<p>adding hook for auto update (<i>./hg/hgrc</i>):</p>
</p>
<pre>
[hooks]
commit = python:freenethg.updatestatic_hook

[freenethg]
inserturi = USK@foo,bar/Name/1
requesturi = USK@oof,rab/Name/1
fcphost = 127.0.0.1
fcpport = 9481
</pre>
or
<pre>
[hooks]
commit = python:freenethg.updatestatic_hook2

[freenethg]
inserturi = USK@foo,bar/Name/1
requesturi = USK@oof,rab/Name/1
fcphost = 127.0.0.1
fcpport = 9481
uploadkeyword = triggerword
</pre>
or
<pre>
[hooks]
commit = python:freenethg.updatestatic_hook3

[freenethg]
inserturi = USK@foo,bar/Name/1
requesturi = USK@oof,rab/Name/1
fcphost = 127.0.0.1
fcpport = 9481
uploadkeyword = triggerword
</pre>
<h3>How to deal with updates over freenet</h3>
<p>way #1<br>
use -1 instaed 1 as edition number to force the node to look for newer editions before delivering data</p>
<p>way #2<br>
add the repository USK to your bookmarks, so you get notified if a new edition is found</p>

<h3>Commit notification over freenet</h3>

<pre>
[freenethg]
notify = name name2 ...
messagetemplate = /path/to/template # use for all notifies

[notify_name]
type = fmsnntp (in progress)
messagetemplate = /path/to/template # per notify template
....

[notify_name2]
type = fmsfcp (not yet)
....

[notify_name3]
type = frost (not yet)
....

[notify_name4]
type = freemail (not yet)
....

[notify_name5]
type = freetalk (not yet)
....

</pre>

<h3>Default index page</h3>
The standard hg repository is not a regular freesite, so you get usually a<br>
"Not in Archive" error if you access the repos uri in fproxy.<br>
To resolve this problem, pyFreenetHg generates a simple index page.<br>
&nbsp;<br>
You can provide your own html template by adding this option:<br>
&nbsp;<br>

<pre>
[freenethg]
indextemplate = /path/to/template
</pre>

You can use variables in the template which will be replaced by pyFreenetHg.<br>
At the moment following variables are available:<br>
&nbsp;<br>
<ul>
<li> $uri - the URI of your repository
<li> $fmsuser - your fms username, if provided in the config (see above)
</ul>

<!-- h3>eclipse</h3>
<p>modified MercurialEclipse plugin (vectrace, 0.1.102) to fire fcp-createstatic and fcp-updatestatic from within eclipse</p>
<p>use this key as eclipse update site or open it in your browser and download &amp; install it manually.</p>
<p><a href="USK@MYLAnId-ZEyXhDGGbYOa1gOtkZZrFNTXjFl1dibLj9E,Xpu27DoAKKc8b0718E-ZteFrGqCYROe7XBBJI57pB4M,AQACAAE/FreenetUpdateSite/1/" target="_blank">http://127.0.0.1:8888/USK@MYLAnId-ZEyXhDGGbYOa1gOtkZZrFNTXjFl1dibLj9E,Xpu27DoAKKc8b0718E-ZteFrGqCYROe7XBBJI57pB4M,AQACAAE/EclipseUpdateSite/1/</a></p -->
</body>
</html>
